(function(){angular.module("eatribApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("eatribApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("eatribApp").controller("homeCtrl",e);e.$inject=["$scope","eatribData","geolocation"];function e(e,t,o){var n=this;n.pageHeader={title:"EatRib",strapline:"Find places to eat near you in Ribadesella!"};n.sidebar={content:"Looking for a place to drink and eat in Ribadesella? EatRib helps you find places to have fun and eat premium quality food. Perhaps with sider, beer or coffe? Let EatRib help you find the place you're looking for."};n.message="Checking your location";n.loading=true;n.getData=function(e){var o=e.coords.latitude;var r=e.coords.longitude;n.message="Searching for nearby places";t.locationByCoords(o,r).success(function(e){n.message=e.length>0?"":"No locations found nearby";n.data={locations:e}}).error(function(e){n.message="Sorry, something's gone wrong";console.log(e)}).finally(function(){n.loading=false})};n.showError=function(t){e.$apply(function(){n.message=t.message;n.loading=false})};n.noGeo=function(){e.$apply(function(){n.message="Geolocation not supported by this browser.";n.loading=false})};o.getPosition(n.getData,n.showError,n.noGeo)}})();(function(){angular.module("eatribApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About EatRib"};e.main={content:"EatRib was created to help people find places to drink and eat in Ribadesella.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit."}}})();(function(){angular.module("eatribApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$uibModal","eatribData"];function e(e,t,o){var n=this;n.locationid=e.locationid;o.locationById(n.locationid).success(function(e){n.data={location:e};n.pageHeader={title:n.data.location.name}}).error(function(e){console.log(e)});n.popupReviewForm=function(){var e=t.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:n.locationid,locationName:n.data.location.name}}}});e.result.then(function(e){n.data.location.reviews.push(e)})}}})();(function(){angular.module("eatribApp").controller("reviewModalCtrl",e);e.$inject=["$uibModalInstance","eatribData","locationData"];function e(e,t,o){var n=this;n.locationData=o;n.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}};n.onSubmit=function(){n.formError="";if(!n.formData||!n.formData.name||!n.formData.rating||!n.formData.reviewText){n.formError="All fields required, please try again";return false}else{n.doAddReview(n.locationData.locationid,n.formData)}};n.doAddReview=function(e,o){t.addReviewById(e,{author:o.name,rating:o.rating,reviewText:o.reviewText}).success(function(e){n.modal.close(e)}).error(function(e){n.formError="Your review has not been saved, please try again"});return false}}})();(function(){angular.module("eatribApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Create a new EatRib account"};o.credentials={name:"",email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials||!o.credentials.name||!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.formError="";t.register(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}})();(function(){angular.module("eatribApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Sign in to EatRib"};o.credentials={email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials||!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";t.login(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}})();(function(){angular.module("eatribApp").service("geolocation",e);function e(){var e=function(e,t,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{o()}};return{getPosition:e}}})();(function(){angular.module("eatribApp").service("eatribData",e);e.$inject=["$http"];function e(e){var t=function(t,o){return e.get("/api/locations?lng="+o+"&lat="+t+"&maxdist=2000000")};var o=function(t){return e.get("/api/locations/"+t)};var n=function(t,o){return e.post("/api/locations/"+t+"/reviews",o)};return{locationByCoords:t,locationById:o,addReviewById:n}}})();(function(){angular.module("eatribApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var o=function(e){t.localStorage["eatrib-token"]=e};var n=function(){return t.localStorage["eatrib-token"]};var r=function(){var e=n();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var a=function(){if(r()){var e=n();var o=JSON.parse(t.atob(e.split(".")[1]));return{email:o.email,name:o.name}}};register=function(t){return e.post("/api/register",t).success(function(e){o(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){o(e.token)})};logout=function(){t.localStorage.removeItem("eatrib-token")};return{currentUser:a,saveToken:o,getToken:n,isLoggedIn:r,register:register,login:login,logout:logout}}})();(function(){angular.module("eatribApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(e){if(e>=1e3){return(parseFloat(e/1e3).toFixed(1)+" km").replace(".0","")}else{return parseFloat(e).toFixed(0)+" m"}}}})();(function(){angular.module("eatribApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("eatribApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directive/ratingStars/ratingStars.template.html"}}})();(function(){angular.module("eatribApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directive/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("eatribApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directive/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("eatribApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.currentPath=e.path();o.isLoggedIn=t.isLoggedIn();o.currentUser=t.currentUser();o.logout=function(){t.logout();o.isLoggedIn=t.isLoggedIn();e.path("/")}}})();(function(){angular.module("eatribApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directive/pageHeader/pageHeader.template.html"}}})();